<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1">
        <title>Index</title>

        <link rel="stylesheet" type="text/css" href="/static/skin/css/global.css" />
        <link rel="stylesheet" type="text/css" href="/static/skin/css/{{ .style }}.css" />
    </head>
    <body>
        <h1>This is index page !</h1>
        <p>Gin.H     => .info : {{ .info }}</p>
        <p>/api/user/info => data  : <span id="text-target"></span></p>
        <div id="container"></div>
        <div id="singleWebSocket">
            <input id="content" type="text" />
            <button id="send">Send</button>
            <pre id="pre"></pre>
        </div>        
        <div id="chatRoom">
            <input id="chat" type="text" />
            <button id="button">Chat</button>
            <pre id="room"></pre>
        </div>
        <script type="text/javascript" src="/static/js/jquery-1.9.1.min.js"></script>
        <script type="text/javascript" src="/static/js/three.min.js"></script>
        <script type="text/javascript" src="/static/component/chainsWebSocket/chainsWebSocket.js"></script>
        <script>
            $(document).ready(function() {
                $("#singleWebSocket").ChainsWebSocket({
                    "wsPort": "8009",
                    "wsUrl": "localhost",
                    "inputContainer": "#content",
                    "buttonContainer": "#send"
                });
                $("#chatRoom").ChainsWebSocket({
                    "wsPort": "8009",
                    "wsUrl": "localhost",
                    "service": "wsBroadcast",
                    "inputContainer": "#chat",
                    "buttonContainer": "#button",
                    "targetContainer": "#room"
                });
                $.getJSON("/api/user/info", function(data) {
                    $("#text-target").html("<br/>   mobile ==> " + data.info.mobile + "<br/>   password ==>" + data.info.password);
                });

                var scene,
                    camera,
                    light,
                    renderer,
                    earthObject; 
                var WIDTH = 900,
                    HEIGHT = 400;
                var angle = 75,
                    aspect = WIDTH / HEIGHT,
                    near = 0.1,
                    far = 3000;
                var container = document.getElementById('container');
                
                $(window).resize(function() {
                    renderer.setSize(window.innerWidth, window.innerHeight);
                });

                //场景
                renderer = new THREE.WebGLRenderer({
                    antialiasing : true //抗锯齿
                });
                renderer.setSize(WIDTH, HEIGHT);
                renderer.domElement.style.position = 'relative';
                container.appendChild(renderer.domElement);
                renderer.autoClear = false;
                //打开渲染器的地图阴影
                renderer.shadowMapEnabled = false;

                //摄像仪
                camera = new THREE.PerspectiveCamera(angle, aspect, near, far);

                camera.position.set(0, 0, 0);
                scene = new THREE.Scene();
                
                // 设置聚光灯光源
                // light = new THREE.SpotLight(0xffffff, 1, 0, Math.PI / 2, 1);
                // light.position.set(4000, 4000, 1500);
                // light.target.position.set(1000, 3800, 1000);
                // scene.add(light);
                
                // 设置平行光源
                var directionalLight = new THREE.DirectionalLight(0xffffff, 1.0, 0);        
                directionalLight.position.set( 0, 0, -10000 );                             
                scene.add(directionalLight);

                //地球
                var earthGeo = new THREE.SphereGeometry (30, 40, 400);
                //                   Phong(冯氏)材质类型 
                //          对光照也有反应，用于创建金属类明亮的物体
                //                           ||
                //                           Ｖ
                var earthMat = new THREE.MeshPhongMaterial({
                    map: THREE.ImageUtils.loadTexture('/static/skin/image/earth.jpg'),
                    bumpMap: THREE.ImageUtils.loadTexture('/static/skin/image/bump-map.jpg'),
                    bumpScale: 10,
                    opacity: 0.47
                    // color: 0xff3220,
                    // ambient：设置材质的环境色，和AmbientLight光源一起使用，这个颜色会与环境光的颜色相乘。即是对光源作出反应。
    　　            // emissive：设置材质发射的颜色，不是一种光源，而是一种不受光照影响的颜色。默认为黑色
    　　            // specular：指定该材质的光亮程度及其高光部分的颜色，如果设置成和color属性相同的颜色，则会得到另一个更加类似金属的材质，如果设置成grey灰色，则看起来像塑料
    　　            // shininess：指定高光部分的亮度，默认值为30
                }); 
                var earthMesh = new THREE.Mesh(earthGeo, earthMat); 
                earthMesh.position.set(-100, 0, 0); 
                earthMesh.rotation.x = 0.2;
                scene.add(earthMesh);

                camera.lookAt(earthMesh.position);
                
                //STARS
                var starGeo = new THREE.SphereGeometry (3000, 10, 100),
                    starMat = new THREE.MeshBasicMaterial();
                starMat.map = THREE.ImageUtils.loadTexture('/static/skin/image/star.png');
                starMat.side = THREE.BackSide;            
                var starMesh = new THREE.Mesh(starGeo, starMat);
                            
                scene.add(starMesh);

                var render = function () {
                    requestAnimationFrame( render );
                    //earthMesh.rotation.x += 0.01;
                    earthMesh.rotation.y += 0.005;

                    renderer.render(scene, camera);
                };

                render();
            });
        </script>
    </body>
</html>